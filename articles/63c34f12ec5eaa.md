---
title: "Pythonã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ã (pytest)"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['Python']
published: false
---
Pythonã§ãƒ†ã‚¹ãƒˆã‚’æ›¸ãæ–¹æ³•ã¨ã—ã¦ã€å¤§ããåˆ†ã‘ã¦æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®unittestã‚’ä½¿ã†æ–¹æ³•ã¨3rdãƒ‘ãƒ¼ãƒ†ã‚£è£½ã®pytestã‚’ä½¿ã†æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚
ç¾åœ¨ä¸»æµãªã®ã¯pytestã‚’ä½¿ã†æ–¹æ³•ã§ã™ã®ã§ãã¡ã‚‰ã«ã¤ã„ã¦ç°¡å˜ãªä½¿ã„æ–¹ã‚’è¨˜ã—ã¾ã™ã€‚
åŸºæœ¬çš„ã«[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.pytest.org/en/latest/contents.html)ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚

:::details ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
```shell
python3 -m pip install -U pytest
pytest --version
```
:::

# ç°¡å˜ãªä½¿ã„æ–¹
```python: test_sample.py
def func(x):
    return x + 1

def test_answer():
    assert func(3) == 5
```
ã“ã‚Œã«å¯¾ã—ã¦`pytest -q test_sample.py`ã¨å®Ÿè¡Œã™ã‚‹ã¨ãƒ†ã‚¹ãƒˆçµæœãŒè¿”ã£ã¦ãã¾ã™ã€‚
```
$ pytest -q test_sample.py 
F                                                                                          [100%]
============================================ FAILURES ============================================
__________________________________________ test_answer ___________________________________________

    def test_answer():
>       assert func(3) == 5
E       assert 4 == 5
E        +  where 4 = func(3)

test_sample.py:6: AssertionError
==================================== short test summary info =====================================
FAILED test_sample.py::test_answer - assert 4 == 5
1 failed in 0.01s
```

:::details ä¾‹å¤–ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹
```python test_sysexit.py
import pytest


def f():
    raise SystemExit(1)

def test_mytest():
    with pytest.raises(SystemExit):
        f()
```
```shell
$ pytest -q test_sysexit.py 
.                                                                                          [100%]
1 passed in 0.00s
```
:::

:::details ãƒ†ã‚¹ãƒˆã‚’ã‚¯ãƒ©ã‚¹ã«ã¾ã¨ã‚ã‚‹
```python:test_class.py
class TestClass:
    def test_one(self):
        x = "this"
        assert "h" in x

    def test_two(self):
        x = "hello"
        assert hasattr(x, "check")
```

```shell
$ pytest -q test_class.py 
.                                                                                          [100%]
1 passed in 0.00s
```

å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚ˆã‚Šå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã«ãªã‚‹ãŒã€ã‚¯ãƒ©ã‚¹å±æ€§ã‚’æŒ‡å®šã—ãŸå ´åˆã¯å€¤ãŒå…±æœ‰ã•ã‚Œã‚‹ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã‚ã‚‹ã€‚

```python:test_class_demo.py
class TestClassDemoInstance:
    value = 0

    def test_one(self):
        self.value = 1
        assert self.value == 1

    def test_two(self):
        assert self.value == 1
```
```shell
â¯ pytest -q test_class_demo.py 
.F                                                                                         [100%]
============================================ FAILURES ============================================
_________________________________ TestClassDemoInstance.test_two _________________________________

self = <test_sample.TestClassDemoInstance object at 0x1035ebdc0>

    def test_two(self):
>       assert self.value == 1
E       assert 0 == 1
E        +  where 0 = <test_sample.TestClassDemoInstance object at 0x1035ebdc0>.value

test_sample.py:9: AssertionError
==================================== short test summary info =====================================
FAILED test_sample.py::TestClassDemoInstance::test_two - assert 0 == 1
1 failed, 1 passed in 0.01s
```
:::

# ã‚½ãƒ¼ã‚¹ã¨ãƒ†ã‚¹ãƒˆã‚’åˆ†ã‘ãªã„å ´åˆ

```
.
â””â”€â”€ src
    â”œâ”€â”€ fibonacci.py
    â””â”€â”€ test_fibonacci.py
```

```python:fibonacci.py
def Fibonacci() -> int:
    ls = {0: 0, 1: 1}
    def f(n):
        nonlocal ls
        if len(ls) <= n:
            ls[n] = f(n-2) + f(n-1)
        return ls[n]
    return f
```
```python:test_fibonacci.py
from fibonacci import Fibonacci

def test_Fibonacci():
    fib = Fibonacci()
    assert fib(10) == 55
```
ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒã‚½ãƒ¼ã‚¹ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹å ´åˆã¯é›£ã—ããªãã€`test_*.py`ã¾ãŸã¯`*_test.py`ã¨å‘½åã•ã‚ŒãŸå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã“ã®ã¾ã¾`pytest`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚


# ã‚½ãƒ¼ã‚¹ã¨ãƒ†ã‚¹ãƒˆã‚’åˆ†ã‘ã‚‹å ´åˆ
è‡ªåˆ†ã§ã‚ã‚‹ç¨‹åº¦ã¾ã¨ã¾ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå ´åˆã¯ã‚½ãƒ¼ã‚¹ã¨ãƒ†ã‚¹ãƒˆã¯åˆ†ã‘ã‚‹ã®ãŒæœ›ã¾ã—ã„ã‹ã¨æ€ã„ã¾ã™ã€‚
```
.
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ src
â”‚   â””â”€â”€ fibonacci.py
â””â”€â”€ tests
    â””â”€â”€ test_fibonacci.py
```
```python:test_fibonacci.py
import pytest

from src.fibonacci import Fibonacci

@pytest.mark.parametrize(('number', 'expected'),[
    (0, 0),
    (1, 1),
    (2, 1),
    (100, 354224848179261915075),
    (500, 139423224561697880139724382870407283950070256587697307264108962948325571622863290691557658876222521294125),
])
def test_fibonacci(number, expected):
    fib = Fibonacci()
    assert fib(number) == expected
```
ãã®éš›ã€`pytest`ã¨å®Ÿè¡Œã—ã¦ã‚‚importã®éš›ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚
```
    from src.fibonacci import Fibonacci
E   ModuleNotFoundError: No module named 'src'
```
ã“ã‚Œã®å¯¾å¿œç­–ã®ä¸€ã¤ã¯`pyproject.toml`ã‚’ç”¨æ„ã—ã¦ãƒ«ãƒ¼ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã«åŠ ãˆã‚‹ã“ã¨ã§ã™ã€‚
```toml:pyproject.tomls
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "YOUR_PACKAGE_NAME"
version = "0.0.1"
```
ä¸Šã®ã‚ˆã†ãªtomlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—
```shell
pip install -e .
```
ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ãƒ«ãƒ¼ãƒˆã‹ã‚‰ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå¯èƒ½ã«ãªã‚Šã‚¨ãƒ©ãƒ¼ãŒå‡ºãªããªã‚Šã¾ã™ã€‚