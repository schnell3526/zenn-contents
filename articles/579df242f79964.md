---
title: "è¡Œåˆ—ç©ã®å‹¾é…ã‚’èª¤å·®é€†ä¼æ’­æ³•ã«ã‚ˆã‚Šæ±‚ã‚ã‚‹"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['deeplearning', 'æ•°å­¦', 'è¡Œåˆ—', 'èª¤å·®é€†ä¼æ’­æ³•']
published: true
---

[ã‚¼ãƒ­ã‹ã‚‰ä½œã‚‹Deep Learningâ€•â€•Pythonã§å­¦ã¶ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã®ç†è«–ã¨å®Ÿè£…](https://www.oreilly.co.jp/books/9784873117584/)ã®è¡Œåˆ—ç©è¨ˆç®—ã®èª¤å·®é€†ä¼æ’­æ³•ã«ã‚ˆã‚‹å‹¾é…è¨ˆç®—ã«ã¤ã„ã¦ã®è¨˜è¿°å€‹äººçš„ã«åˆ†ã‹ã‚Šã¥ã‚‰ãã€ã¾ãŸé€”ä¸­è¨ˆç®—ãŒçœç•¥ã•ã‚Œã¦ã„ãŸã®ã§è‡ªåˆ†ã¸ã®å‚™å¿˜éŒ²ãŒã¦ã‚‰ã“ã¡ã‚‰ã§é€”ä¸­è¨ˆç®—ã‚’æ¥µåŠ›çœã‹ãšèª¬æ˜ã—ã¦ã„ãã€‚

# èª¤å·®é€†ä¼æ’­æ³•ã¨ã¯
èª¤å·®é€†ä¼æ’­æ³•(backpropagation)ã¯æ·±å±¤å­¦ç¿’ã«ãŠã„ã¦ãƒ‘ãƒ©ãƒ¡ã‚¿ã®æ›´æ–°ã‚’ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå‹¾é…ã®è¨ˆç®—ã‚’é«˜é€Ÿã«è¡Œã†ãŸã‚ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã‚ã‚‹ã€‚
å¾®åˆ†(å‹¾é…)ã‚’è¨ˆç®—ã™ã‚‹ã«ã‚ãŸã‚Šè¿‘ä¼¼çš„ã«è¨ˆç®—ã™ã‚‹æ–¹æ³•(æ•°å€¤å¾®åˆ†)ã§ã¯CPUã«ã¨ã£ã¦ãƒãƒ¼ãƒ‰ãªè¨ˆç®—ãŒå¿…è¦ã§ã‚ã‚Šå­¦ç¿’ã®åŠ¹ç‡ãŒéå¸¸ã«æ‚ªããªã‚‹ã€‚ãã®å•é¡Œã®è§£æ±ºã¨ã—ã¦ç¾åœ¨ã®æ·±å±¤å­¦ç¿’ã«ãŠã„ã¦åºƒãç”¨ã„ã‚‰ã‚Œã¦ã„ã‚‹ã®ãŒèª¤å·®é€†ä¼æ’­æ³•ã§ã‚ã‚Šè§£æçš„ãªå¾®åˆ†å€¤ã‚’é«˜é€Ÿã«è¨ˆç®—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ã€‚

# è¨ˆç®—ãƒãƒ¼ãƒ‰
æ¬¡ã®ã‚ˆã†ãªãƒ™ã‚¯ãƒˆãƒ«$\bm{X}$(å…¥åŠ›å€¤)ãŠã‚ˆã³è¡Œåˆ—$\bm{W}$(é‡ã¿)ã®è¡Œåˆ—ç©ã‚’èª¤å·®é€†ä¼æ’­æ³•ã§è¨ˆç®—ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/67a915332bfaf2345e0fb2ea.png)

æœ¬è¨˜äº‹ã§ã¯ã‚¼ãƒ­ã‹ã‚‰æœ¬ã«ç¿’ã„ãƒ™ã‚¯ãƒˆãƒ«ã¯è¡Œãƒ™ã‚¯ãƒˆãƒ«ã¨è€ƒãˆã€$\bm{X}$ã¯$(1 \times n)$ã®è¡Œãƒ™ã‚¯ãƒˆãƒ«ã€$\bm{W}$ã¯$(n \times m)$ã®è¡Œåˆ—ã¨ã™ã‚‹ã€‚ã“ã®æ™‚å‡ºåŠ›$(\bm{X}\cdot \bm{W}) = \bm{Y}$ã¯$(1 \times m)$ã®è¡Œãƒ™ã‚¯ãƒˆãƒ«ã¨ãªã‚‹ã€‚
ã¾ã¨ã‚ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã€

$$
\begin{align}
        &\bm{X} = \begin{pmatrix}
            x_1 & x_2 & \dots & x_n
        \end{pmatrix}\\
        &\bm{W} = \begin{pmatrix} 
            w_{11} & w_{12} & \dots  & w_{1m} \\
            w_{21} & w_{22} & \dots  & w_{2m} \\
            \vdots & \vdots & \ddots & \vdots \\
            w_{n1} & w_{n2} & \dots  & w_{nm}
        \end{pmatrix}\\
        &\bm{Y} = \begin{pmatrix}
            y_1 & y_2 & \dots & y_m
        \end{pmatrix}
    \end{align}
$$

ã“ã®è¨ˆç®—ãƒãƒ¼ãƒ‰ã®å‹¾é…ã‚’èª¤å·®é€†ä¼æ’­æ³•ã«ã‚ˆã‚Šç®—å‡ºã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ã€‚

$$
\begin{align}
\frac{\partial L}{\partial \bm{W}} = \bm{X}^\mathsf{T} \cdot \frac{\partial L}{\partial \bm{Y}}\\
\frac{\partial L}{\partial \bm{X}} = \frac{\partial L}{\partial \bm{Y}} \bm{W}^\mathsf{T}
\end{align}
$$

ã“ã‚Œã‹ã‚‰ä¸Šã®äº‹å®Ÿã‚’å°ã„ã¦ã„ãã€‚

# å‰æ
## è¡Œåˆ—è¨ˆç®—ã«é–¢ã—ã¦
å‡ºåŠ›$\bm{Y}$ã®æˆåˆ†$y_i$ã¯è¡Œåˆ—ã®ç©æ¼”ç®—ãªã®ã§æ¬¡ã®ã‚ˆã†ã«è¨ˆç®—ã§ãã‚‹ã€‚

$$
\begin{align}
y_i = \sum_{l = 1}^{n} w_{li}x_l 
\end{align}
$$

## åå¾®åˆ†ã«é–¢ã—ã¦
$n$å€‹ã®å¤‰æ•°$y_1, y_2, \dots, y_n$(ãŸã ã—$y_i$ã¯ãã‚Œãã‚Œ$x_1, x_2, \dots, x_n$ã«ã¤ã„ã¦ã®é–¢æ•°ã¨ã™ã‚‹)ã‚’æŒã¤é–¢æ•°$f$ã‚’$x_i$ã§åå¾®åˆ†ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨çµæœã¯åå¾®åˆ†ã®é€£é–ç‡ã‚ˆã‚Šä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã€‚

$$
\begin{align}
\frac{\partial f}{\partial x_i} = \sum_{j = 1}^{n} \frac{\partial f}{\partial y_j} \frac{\partial y_j}{\partial x_i} 
\end{align}
$$

# å‹¾é…ã®è¨ˆç®—
## $\frac{\partial L}{\partial \bm{W}}$ã‚’æ±‚ã‚ã‚‹
ã¾ãšå„æˆåˆ†$\frac{\partial L}{\partial w_{ij}}$ã‚’æ±‚ã‚ã‚‹ã€‚

$$
\begin{align}
        \frac{\partial L}{\partial w_{ij}} &= \sum_{k = 1}^{m} \frac{\partial L}{\partial y_k} \frac{\partial y_k}{\partial w_{ij}}\\
        &= \frac{\partial L}{\partial y_j} \frac{\partial y_j}{\partial w_{ij}}\\
        &= \frac{\partial L}{\partial y_j} x_i
\end{align}
$$

è¨ˆç®—ã‚’è©³ã—ãè¿½ã£ã¦ã„ãã¨ã€ã¾ãš(8)ã®ç­‰å·ã¯åå¾®åˆ†ã®é€£é–ç‡(7)ã‚ˆã‚Šæˆã‚Šç«‹ã¤ã€‚æ¬¡ã«(9),(10)ã®ç­‰å·ã¯(6)ã‚ˆã‚Š$w_{ij}$ã‚’å«ã‚€ã®ã¯$j$ã®ã¿ã§ã‚ã‚Šä»–ã®é …ã¯åå¾®åˆ†ã«ã‚ˆã‚Šæ¶ˆãˆã‚‹ã®ã§æˆã‚Šç«‹ã¤ã€‚

ã“ã®çµæœã‚’å…ƒã«$\frac{\partial L}{\partial \bm{W}}$ã‚’è¨ˆç®—ã™ã‚‹ã¨

$$
\begin{align}
        \frac{\partial L}{\partial \bm{W}} &= \begin{pmatrix} 
            \frac{\partial L}{\partial y_1} x_1 & \frac{\partial L}{\partial y_2} x_1 & \dots  & \frac{\partial L}{\partial y_m} x_1 \\
            \frac{\partial L}{\partial y_1} x_2 & \frac{\partial L}{\partial y_2} x_2 & \dots  & \frac{\partial L}{\partial y_m} x_2 \\
            \vdots & \vdots & \ddots & \vdots \\
            \frac{\partial L}{\partial y_1} x_n & \frac{\partial L}{\partial y_2} x_n & \dots  & \frac{\partial L}{\partial y_m} x_n
        \end{pmatrix}\\
        &= \begin{pmatrix}
            x_1 \\ x_2 \\ \vdots \\ x_n
        \end{pmatrix}
        \cdot \begin{pmatrix}
            \frac{\partial L}{\partial y_1} & \frac{\partial L}{\partial y_2} & \dots & \frac{\partial L}{\partial y_m}
        \end{pmatrix}\\
        &= \bm{X}^\mathsf{T} \cdot \frac{\partial L}{\partial \bm{Y}}
    \end{align}
$$

## $\frac{\partial L}{\partial \bm{X}}$ã‚’æ±‚ã‚ã‚‹
ã¾ãšå„æˆåˆ†$\frac{\partial L}{\partial x_{i}}$ã‚’æ±‚ã‚ã‚‹ã€‚

$$
\begin{align}
        \frac{\partial L}{\partial x_i} &= \sum_{j = 1}^{m} \frac{\partial L}{\partial y_j} \frac{\partial y_j}{\partial x_i}\\
        &= \sum_{j = 1}^{m} \frac{\partial L}{\partial y_j} w_{ij}
\end{align}
$$

è¨ˆç®—ã‚’è©³ã—ãè¿½ã£ã¦ã„ãã¨ã€ã¾ãš(14)ã®ç­‰å·ã¯å…ˆã»ã©ã¨åŒæ§˜ã«åå¾®åˆ†ã®é€£é–å¾‹ã«ã‚ˆã‚Šæˆã‚Šç«‹ã¤ã€‚æ¬¡ã«(15)ã®ç­‰å·ã‚‚ã¾ãŸå…ˆã»ã©ã¨åŒæ§˜ã«(6)ã®å¼ã«ã‚ˆã‚Šç®—å‡ºã•ã‚Œã‚‹ã€‚
ã“ã®çµæœã‚’å…ƒã«$\frac{\partial L}{\partial \bm{X}}$ã‚’è¨ˆç®—ã™ã‚‹ã¨

$$
\begin{align}
        \frac{\partial L}{\partial \bm{X}} &= \begin{pmatrix}
            \sum_{j = 1}^{m} \frac{\partial L}{\partial y_j} w_{1j} & \sum_{j = 1}^{m} \frac{\partial L}{\partial y_j} w_{2j} & \dots & \sum_{j = 1}^{m} \frac{\partial L}{\partial y_j} w_{nj}
        \end{pmatrix}\\
        &= \begin{pmatrix}
            \frac{\partial L}{\partial y_1} & \frac{\partial L}{\partial y_2} & \dots & \frac{\partial L}{\partial y_m}
        \end{pmatrix}
        \cdot \begin{pmatrix}
            w_{11} & w_{21} & \dots  & w_{m1} \\
            w_{12} & w_{22} & \dots  & w_{m2} \\
            \vdots & \vdots & \ddots & \vdots \\
            w_{1n} & w_{2n} & \dots  & w_{mn}
        \end{pmatrix}\\
        &= \frac{\partial L}{\partial \bm{Y}} \bm{W}^\mathsf{T}
    \end{align}
$$

