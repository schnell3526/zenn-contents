---
title: "AWS EC2ä¸Šã«Dockerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ç°¡å˜ãªWebã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹"
emoji: "ğŸ¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Docker", "AWS", "EC2"]
published: True
---

æœ¬è¨˜äº‹ã§åˆ©ç”¨ã™ã‚‹EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä»¥ä¸‹ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
- ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—: t2.micro
- OSã‚¤ãƒ¡ãƒ¼ã‚¸: Amazon Linux

ã¾ãŸã€ã“ã®æ‰‹é †ã‚’è©¦ã™ã«ã‚ãŸã£ã¦è‡ªèº«ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹(ã¾ãŸã¯ä»»æ„ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹)ã‹ã‚‰ãƒãƒ¼ãƒˆç•ªå·22(sshç”¨), 80(httpç”¨)ã«å¯¾ã—ã¦ã®ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

# Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell
sudo yum update -y
sudo yum -y install docker
```
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‹ã©ã†ã‹ã®ç¢ºèªãŒãªã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã®ã§ã€`y`ã‚’å…¥åŠ›ã™ã‚‹ã€‚

```shell
# Dockerãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’èµ·å‹•
sudo systemctl start docker
sudo systemctl enable docker
# sudoç„¡ã—ã§dockerã‚³ãƒãƒ³ãƒ‰ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«(ec2-userã¯Amzon Linuxã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼)
sudo usermod -aG docker ec2-user
```

ã“ã“ã¾ã§ã‚„ã£ãŸã‚‰ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ä¸€åº¦ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ(Ctrl+d)ã—ã¦å†åº¦sshãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã€‚

```shell
# dockerã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã“ã¨ã‚’ç¢ºèª
docker info
# docker hubã«ãƒ­ã‚°ã‚¤ãƒ³
docker login
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒèã‹ã‚Œã‚‹ã®ã§ã€Docker Hubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã€‚

ã€ŒLogin Succeededã€ã¨è¡¨ç¤ºã•ã‚ŒãŸã‚‰Dockerã®æº–å‚™ã¯å®Œäº†ã§ã™ã€‚

# Flaskã§ä½œã£ãŸWebã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹

æ¬¡ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¨ã—ã¾ã™ã€‚

```shell
.
â”œâ”€â”€ Dockerfile
â””â”€â”€ app.py
```

## Dockerfileã‚’ç·¨é›†

```Dockerfile
FROM python:3.10.9-slim-buster

WORKDIR /python-app
RUN pip3 install flask

COPY ./app.py /python-app/app.py

EXPOSE 8080
ENTRYPOINT ["python3", "app.py"]
```

## `app.py`ã‚’ç·¨é›†

```python
from flask import Flask
import os

app = Flask(__name__)

name = os.environ['name']

@app.route('/dockerdemo')
def dockerdemo():
    return name + " welcome to my container!"

if (__name__) == "__main__":
    app.run(host='0.0.0.0', port=8080, debug=True)
```

## ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•
Dockerfileã‹ã‚‰Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
```shell
docker build --tag dockerdemo ./
```

ä½œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã€‚`-e name='schnell'`ã§ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ç’°å¢ƒå¤‰æ•°ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚å¥½ããªã¾ãˆã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
```shell
docker run -d --name dockerdemo -e name='schnell' -p 80:8080 dockerdemo
```

ã“ã“ã¾ã§æ¥ãŸã‚‰ã€`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹:80/dockerdemo`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/d02d2a4ce957-20221223.png)