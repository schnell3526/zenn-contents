---
title: "Dev Container ã§å§‹ã‚ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã§å …ç‰¢ãª Python é–‹ç™ºç’°å¢ƒæ§‹ç¯‰"
emoji: "ğŸ³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "Docker", "devcontainer"]
published: true
---

# æ¦‚è¦
é–‹ç™ºç’°å¢ƒã‚’çµ±ä¸€ã—å…±é€šã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã€è¨€èªã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚‚ã¨é–‹ç™ºã‚’è¡Œã†ã“ã¨ã¯ãƒãƒ¼ãƒ é–‹ç™ºã‚’è¡Œã†éš›ã«éå¸¸ã«å¤§åˆ‡ã§ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯ãã‚Œã‚‰ã‚’è€ƒæ…®ã—ãŸé–‹ç™ºç’°å¢ƒã‚’è¿…é€Ÿã«æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ä¸€ã¤ã®ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ã—ã¦ VSCode âœ–ï¸ Dev Container ã‚’ä½¿ã£ãŸæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

å®Œæˆã—ãŸé–‹ç™ºç’°å¢ƒã«é–¢ã—ã¦ã¯ä»¥ä¸‹ã§å…¬é–‹ã—ã¦ãŠã‚Šã¾ã™ã®ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ä½¿ã£ãŸã‚Šã€ä¸€ã¤ã®å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚
https://github.com/schnell3526/python-project-with-devcontainer

ç´¹ä»‹ã™ã‚‹ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®å¼·ã¿ã¯ä»¥ä¸‹ã§ã™ã€‚
- ç’°å¢ƒæ§‹ç¯‰ã‚’ã‚³ãƒ¼ãƒ‰åŒ–ã™ã‚‹ã“ã¨ã§ã€æ‰‹é †ã‚’æ˜ç¢ºã«å®šç¾©ã—ã¦ã„ã‚‹ã“ã¨
- **Dockerç’°å¢ƒãŒã‚ã‚Œã°ã™ãã«åˆ©ç”¨å¯èƒ½**ãªã€ãƒãƒ¼ã‚¿ãƒ–ãƒ«ãªé–‹ç™ºç’°å¢ƒã§ã‚ã‚‹ã“ã¨ã€€
- é–‹ç™ºç’°å¢ƒã‚’**ç°¡å˜ã«ç ´æ£„ï¼†å†ä½œæˆã§ãã‚‹**ãŸã‚ã€ç’°å¢ƒã®åŠ£åŒ–ã«æ‚©ã¾ã•ã‚Œãªã„
- ã€Œã“ã®ç’°å¢ƒã§ã—ã‹å‹•ã‹ãªã„ã€å•é¡Œã‚’è§£æ¶ˆã—ã€é«˜ã„å†ç¾æ€§ã‚’å®Ÿç¾
- linter/formatter ã®è¨­å®šã‚’åŒæ¢±ã—ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ãŒçµ±ä¸€ã§ãã‚‹

å‹•ä½œã«ã¤ã„ã¦ã¯ã€Linux (Ubuntu) ç’°å¢ƒã€MACOS ã«ã¤ã„ã¦ç¢ºèªã—ã¦ã„ã¾ã™ã€‚ä½•ã‹ä¸å‚™ãŒã‚ã‚Œã°ã‚³ãƒ¡ãƒ³ãƒˆã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚


:::message
uv ç‰ˆã‚‚ä½œæˆã—ã¾ã—ãŸã€‚uv ç‰ˆã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€`feat/uv` ã«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¦ãã ã•ã„
```bash
git clone https://github.com/schnell3526/python-project-with-devcontainer.git
git switch feat/uv
```
:::

# Dev Container ã®èµ·å‹•æ‰‹é †
åˆ©ç”¨ã«ã‚ãŸã‚Šã€[Dev Container æ‹¡å¼µ](https://marketplace.visualstudio.com/items/?itemName=ms-vscode-remote.remote-containers)ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ãªã®ã§ç„¡ã‘ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚
```shell
code --install-extension ms-vscode-remote.remote-containers
```

è¨­å®šæ¸ˆã¿ã®ç’°å¢ƒã‚’ clone ã—ãŸã®ã¡ã« VSCode ã§èµ·å‹•ã—ã¦ãã ã•ã„ã€‚
template repository ã®è¨­å®šã‚‚ã—ã¦ã„ã‚‹ã®ã§ã“ã‚Œã‚’ãƒ™ãƒ¼ã‚¹ã«æ–°ã—ã„ç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼
```shell
git clone git@github.com:schnell3526/python-project-with-devcontainer.git
code python-project-with-devcontainer
```

ã€ŒâŒ˜+shift+pã€ã‚’æŠ¼ä¸‹ã—ã¦ã€ŒReopen in Containerã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
![](https://storage.googleapis.com/zenn-user-upload/a7e4d9bfd04e-20250409.png)

ã“ã‚Œã‚’é¸æŠã™ã‚‹ã“ã¨ã§ä»¥ä¸‹ã®ã‚ˆã†ãª Windown ã«åˆ‡ã‚Šæ›¿ã‚ã£ãŸã‚‰ç’°å¢ƒæ§‹ç¯‰å®Œäº†ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/3caf07310cd1-20250409.png)

ã“ã®ç’°å¢ƒã§ã¯ VSCode ã®æ‹¡å¼µã®è¨­å®šã‚„ linter/formatter ã®è¨­å®šãŒå®Œäº†ã—ã¦ãŠã‚Šã€Python ã®ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•æ•´å½¢ã•ã‚Œå‹æ³¨é‡ˆãŒç„¡ã„ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§æŒ‡æ‘˜ãŒå…¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

è©¦ã—ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã¨ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§æŒ‡æ‘˜ãŒå…¥ã‚Šã¾ã™ã€‚
```python:my_package/tmp.py
def add(a, b):
    return a + b
```

æŒ‡æ‘˜ã‚’å…ƒã«ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã¨æŒ‡æ‘˜ãŒå¤–ã‚Œã¾ã™ã€‚
ã“ã®æ™‚ã®ãƒ«ãƒ¼ãƒ«ã«é–¢ã—ã¦ã¯ã€pyproject.toml ã«è¨­å®šã‚’æ›¸ãã“ã¨ã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¯èƒ½ã§ã™ã€‚
ã“ã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€è¤‡æ•°äººã§åŒæ™‚ã«é–‹ç™ºã‚’è¡Œã£ã¦ã‚‚ã‚ã‚‹ç¨‹åº¦çµ±åˆ¶ã®å–ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒä»•çµ„ã¿çš„ã«å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
```python:my_package/tmp.py
"""tmp.py"""


def add(a: int, b: int) -> int:
    """Adds two integers together."""
    return a + b
```

ä»¥é™ã§ã¯è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«è©³ã—ãã‚³ãƒ¼ãƒ‰ã‚’è¿½ã£ã¦ã„ãã¾ã™ã€‚

# ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆ
ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆã¯å¤§ã¾ã‹ã«ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```shell
.
|-- .devcontainer
|   `-- devcontainer.json
|-- .gitignore
|-- README.md
|-- docker
|   |-- Dockerfile
|   `-- compose.yaml
|-- my_package
|   |-- __init__.py
|   `-- main.py
|-- poetry.lock
|-- pyproject.toml
`-- tests
    `-- test_main.py
```

|                  |                                                                                |
| ---------------- | ------------------------------------------------------------------------------ |
| `.devcontainer/` | devcontainer ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«é¡                                                  |
| `docker/`        | Docker é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«                                                            |
| `my_package/`    | python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å (flat layout ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ãŒ src layout ã‚’æ¡ç”¨ã—ã¦ã‚‚ã‚ˆã„) |
| `pyproject.toml` | python ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾å­˜é–¢ä¿‚ã‚„ linter/formatter ã®è¨­å®šã‚’ã™ã‚‹                  |

ä»¥é™ã§ã¯ãã‚Œãã‚Œã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

# [`docker/Dockerfile`](https://github.com/schnell3526/python-project-with-devcontainer/blob/main/docker/Dockerfile#L1)
Dockerfile ã¯ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã‚’åˆ©ç”¨ã—ãŸ 4 ã‚¹ãƒ†ãƒ¼ã‚¸æ§‹æˆã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
`base`, `dev`, `build` ã¯ `python:3.13-bookworm` ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸã‚¹ãƒ†ãƒ¼ã‚¸ã§é–‹ç™ºã‚„ãƒ“ãƒ«ãƒ‰ç”¨é€”ãªã®ã§ç„¡ç†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã®å‰Šæ¸›ã¯ã—ã¦ã„ã¾ã›ã‚“ã€‚
`prod` ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ slim ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é¡ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã®å‰Šæ¸›ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```mermaid
graph TD
    A[python:3.13-bookworm] -->|ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ä½¿ç”¨| B[base]
    B -->|ç¶™æ‰¿| C[dev]
    B -->|ç¶™æ‰¿| D[build]
    E[python:3.13-slim-bookworm] -->|ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ä½¿ç”¨| F[prod]
    D -->|.venvã‚’ã‚³ãƒ”ãƒ¼| F

    style A fill:#f9f9f9,stroke:#333,stroke-width:1px
    style B fill:#d4edda,stroke:#333,stroke-width:2px
    style C fill:#cce5ff,stroke:#333,stroke-width:2px
    style D fill:#fff3cd,stroke:#333,stroke-width:2px
    style E fill:#f9f9f9,stroke:#333,stroke-width:1px
    style F fill:#f8d7da,stroke:#333,stroke-width:2px

    classDef baseImage fill:#f9f9f9,stroke:#333,stroke-width:1px
    classDef stage fill:#f5f5f5,stroke:#333,stroke-width:2px

    class A,E baseImage
    class B,C,D,F stage
```

## base ã‚¹ãƒ†ãƒ¼ã‚¸
base ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã¯ build, dev ã‚¹ãƒ†ãƒ¼ã‚¸ã¨ã‚‚ã«åˆ©ç”¨ã™ã‚‹ Poetry ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚
ç’°å¢ƒå¤‰æ•°ã®è¨­å®šã‚’è¡Œã„ python, pip, poetry ã®åˆ¶å¾¡ã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚
è¨­å®šã®æ„å›³ã«ã¤ã„ã¦ã¯çœãã¾ã™ãŒãã‚Œãã‚Œå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è²¼ã£ãŸã®ã§é©å®œç¢ºèªã—ã¦ãã ã•ã„ã€‚

| ç’°å¢ƒå¤‰æ•°                        | èª¬æ˜                                                                    |                                                                                       |
| ------------------------------- | ----------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| `PYTHONUNBUFFERED`              | å€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã‚Œã°å‡ºåŠ›ã‚’ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã—ãªã„                          | [doc](https://docs.python.org/3.13/using/cmdline.html#cmdoption-u)                    |
| `PYTHONDONTWRITEBYTECODE`       | å€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã‚Œã°ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«(.pyc ã®ç”Ÿæˆ)ã‚’è¡Œã‚ãªã„               | [doc](https://docs.python.org/3.13/using/cmdline.html#envvar-PYTHONDONTWRITEBYTECODE) |
| `PIP_NO_CACHE_DIR`              | pip ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¨­å®šã—ãªã„     [^1]                                   | [doc](https://pip.pypa.io/en/stable/cli/pip/#cmdoption-no-cache-dir)                  |
| `PIP_DISABLE_PIP_VERSION_CHECK` | pip ã®å®šæœŸçš„ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã‚’ç„¡åŠ¹ã«                                | [doc](https://pip.pypa.io/en/stable/cli/pip/#cmdoption-disable-pip-version-check)     |
| `POETRY_VERSION`                | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ Poetry ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³                                    | [doc](https://python-poetry.org/docs/#installing-with-the-official-installer)         |
| `POETRY_HOME`                   | Poetry ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆ                                                 | [doc](https://python-poetry.org/docs/#installing-with-the-official-installer)         |
| `POETRY_VIRTUALENVS_IN_PROJECT` | ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ .venv ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ä½œæˆã•ã‚Œã‚‹[^2] | [doc](https://python-poetry.org/docs/main/configuration#virtualenvsin-project)        |

poetry ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«ã‚ãŸã‚Š curl ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã ã£ãŸã®ã§ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚

## dev ã‚¹ãƒ†ãƒ¼ã‚¸
ä¸»ã« Dev Container ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¨ã—ã¦åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

é–‹ç™ºã«å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã¯ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«é©å®œè¿½åŠ ã—ã¦ã„ãã¨é–‹ç™ºç’°å¢ƒã§ãƒ„ãƒ¼ãƒ«ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```shell
RUN apt-get update \
    && apt-get install --no-install-recommends -y \
        htop \
        jq \
        less \
        sudo \
        tmux \
        tree \
        vim \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*
```

## build ã‚¹ãƒ†ãƒ¼ã‚¸
build ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã„ã¾ã™ã€‚
ãƒã‚¤ãƒ³ãƒˆã¯ `poetry install` ã‚’è¡Œã†å‰ã«ã€`pyproject.toml` åŠã³ `poetry.lock` ã®ã¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã„ã‚‹ç‚¹ã§ã™ã€‚
```dockerfile
COPY pyproject.toml poetry.lock* ./
```

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å¤‰æ›´ãŒãªã„ã‚ˆã†ãªæ›´æ–°ã®å ´åˆã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åŠ¹ã‹ã›ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šãƒ“ãƒ«ãƒ‰æ™‚é–“ã‚’çŸ­ç¸®ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## prod ã‚¹ãƒ†ãƒ¼ã‚¸
prod ã‚¹ãƒ†ãƒ¼ã‚¸ã¯æœ¬ç•ªç¨¼åƒã‚’æƒ³å®šã—ãŸã‚¹ãƒ†ãƒ¼ã‚¸ã§ã™ã€‚
ã‚³ãƒ³ãƒ†ãƒŠã‚’åˆ©ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã€æ§˜ã€…ãªã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒå°ã•ããªã‚‹ãŸã‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã¯ã§ãã‚‹ã ã‘å°ã•ã„ã“ã¨ãŒæœ›ã¾ã—ã„ã§ã™ã€‚
ãã“ã§ã€æœ¬ç•ªç¨¼åƒã«ä¸å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¥µåŠ›æ’é™¤ã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æœ€é©åŒ–ã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚

ä»Šå›ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ±ç”¨çš„ãªæœ€é©åŒ–æ–¹æ³•ã¨ã—ã¦ä»¥ä¸‹ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚
- poetry (ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãƒ„ãƒ¼ãƒ«) ã‚’æœ¬ç•ªç’°å¢ƒã«å«ã‚ãªã„
- ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã‚’æ´»ç”¨ã—ã¦æˆæœç‰©ã®ã¿ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹
- ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ slim ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã™ã‚‹

ã¾ãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹ã«åˆ©ç”¨ã™ã‚‹ãŸã‚ã®å·¥å¤«ã¨ã—ã¦ã€`my_package` (å¤‰æ›´ãŒæ¿€ã—ã„ã¨äºˆæƒ³ã•ã‚Œã‚‹) ã®ã‚³ãƒ”ãƒ¼ä½œæ¥­ã‚’ã§ãã‚‹ã ã‘æœ€å¾Œã«è¡Œã„ã€å¤‰æ›´ãŒè¡Œã‚ã‚Œã¦ã‚‚ãã‚Œã¾ã§ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ãã‚ˆã†ã«æ„è­˜ã—ã¦ã„ã¾ã™ã€‚

# `.devcontainer/devcontainer.json`
`devcontainer.json` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒ Devcontainer ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ `.devcontainer/` ä»¥ä¸‹ã«ç½®ãã¾ã™ã€‚[^3]
è¨­å®šå†…å®¹ã«é–¢ã—ã¦ã¯å…¬å¼ã®[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://containers.dev/implementors/json_reference/#general-properties)ã‚’è¦‹ã¦ãã ã•ã„

## `features`
Dev Container ã«è¿½åŠ ã—ãŸã„ãƒ„ãƒ¼ãƒ«ã‚’å®£è¨€çš„ã«è¨˜è¼‰ã™ã‚‹ã“ã¨ã§ã‚³ãƒ³ãƒ†ãƒŠã«ç°¡å˜ã«ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

:::details ä¾‹
```json
"features": {
    "ghcr.io/devcontainers/features/aws-cli:1": {},
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/dhoeric/features/hadolint:1": {}
}
```
:::

`features` ã§è¿½åŠ ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã«é–¢ã—ã¦ã¯[ã“ã®ãƒšãƒ¼ã‚¸](https://containers.dev/features)ã«ä¸€è¦§ãŒã‚ã‚‹ã®ã§é©å®œå‚ç…§ã—ã¦ãã ã•ã„ã€‚
å…¬å¼ãŒé–‹ç™ºã—ã¦ã„ã‚‹ã‚‚ã®ã¨ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãŒé–‹ç™ºã—ã¦ã„ã‚‹ã‚‚ã®ãŒã‚ã‚‹ãŸã‚ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ã‚‚ã®ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯å„çµ„ç¹”ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã«åˆã‚ã›ã¦æ¡ç”¨ã—ã¦ãã ã•ã„ã€‚
å…¬é–‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯å…¬å¼é–‹ç™ºã® `aws-cli`ã€`docker-outside-of-docker`ã€`github-cli`ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£é–‹ç™ºã® `hadolint` ã‚’ features ã¨ã—ã¦ Dev Container ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚

:::details `hadolint` ã‚’ `features` ã‚’ä½¿ã‚ãšã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ–¹æ³•
`hadolint` ã«é–¢ã—ã¦ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£é–‹ç™ºã® `features` ã‚’ä½¿ã‚ãšã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆã¯ `Dockerfile` ã® dev ã‚¹ãƒ†ãƒ¼ã‚¸ã«ä»¥ä¸‹ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
hadolint ã®ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰æœ€æ–°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã—ã¦ `/usr/local/bin/hadolint` ã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```dockerfile
RUN CURRENT_VERSION=$(curl -Ls 'https://api.github.com/repos/hadolint/hadolint/releases/latest' | grep 'tag_name' | cut -d'v' -f2 | cut -d'"' -f1) \
    && curl -sL -o /usr/local/bin/hadolint "https://github.com/hadolint/hadolint/releases/download/v${CURRENT_VERSION}/hadolint-Linux-x86_64" \
    && chmod +x /usr/local/bin/hadolint
```
ä¼¼ãŸã‚ˆã†ãªæ–¹é‡ã§ä»–ã® CLI ãƒ„ãƒ¼ãƒ«ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚
:::

## [Lifecycle scripts](https://containers.dev/implementors/json_reference/#lifecycle-scripts)

lifecycle scripts ã¯ Dev Container ä½œæˆã®ç‰¹å®šã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã‚’å·®ã—è¾¼ã‚ã‚‹ä»•çµ„ã¿ã§ã€å¤§ã¾ã‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
```mermaid
flowchart TB
    Start["devcontainerä½œæˆãƒ—ãƒ­ã‚»ã‚¹é–‹å§‹"] --> InitializeCommand

    subgraph "ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ä¸Šã§å®Ÿè¡Œ"
        InitializeCommand["initializeCommand
        (åˆæœŸåŒ–æ™‚ãƒ»ä½œæˆæ™‚ãƒ»å†èµ·å‹•æ™‚ã«å®Ÿè¡Œ)"]
    end

    InitializeCommand --> ContainerStart["ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•"]

    subgraph "ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ"
        ContainerStart --> OnCreateCommand["onCreateCommand
        (ã‚³ãƒ³ãƒ†ãƒŠä½œæˆæ™‚ã«æœ€åˆã«å®Ÿè¡Œ)"]

        OnCreateCommand --> UpdateContentCommand["updateContentCommand
        (ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰æ›´æ–°æ™‚ã«å®Ÿè¡Œ
        å°‘ãªãã¨ã‚‚1å›ã¯å®Ÿè¡Œã•ã‚Œã‚‹)"]

        UpdateContentCommand --> WaitFor{"waitForè¨­å®š
        (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: updateContentCommand)"}

        WaitFor --> |"å®Œäº†å¾Œã«ãƒ„ãƒ¼ãƒ«æ¥ç¶š"| ToolConnection["ãƒ„ãƒ¼ãƒ«æ¥ç¶š"]

        WaitFor --> |"ä¸¦è¡Œã—ã¦å®Ÿè¡Œ"| PostCreateCommand["postCreateCommand
        (ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚³ãƒ³ãƒ†ãƒŠãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå¾Œã«å®Ÿè¡Œ)"]

        ToolConnection --> PostAttachCommand["postAttachCommand
        (ãƒ„ãƒ¼ãƒ«ãŒæ¥ç¶šã™ã‚‹(ãƒªãƒ­ãƒ¼ãƒ‰ã®)ãŸã³ã«å®Ÿè¡Œ)"]
    end

    ContainerStart -.-> |"å†èµ·å‹•æ™‚"| PostStartCommand["postStartCommand
    (ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã™ã‚‹ãŸã³ã«å®Ÿè¡Œ)"]

    style InitializeCommand fill:#f9d5e5,stroke:#333
    style OnCreateCommand fill:#eeeeee,stroke:#333
    style UpdateContentCommand fill:#eeeeee,stroke:#333
    style PostCreateCommand fill:#eeeeee,stroke:#333
    style PostStartCommand fill:#e3f2fd,stroke:#333
    style PostAttachCommand fill:#e8f5e9,stroke:#333
    style WaitFor fill:#fff8e1,stroke:#333
```

`InitializeCommand` ã®ã¿ã€Dev Container ä½œæˆé–‹å§‹ç›´å¾Œã«**ãƒ›ã‚¹ãƒˆã§**å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

## [Variables](https://containers.dev/implementors/json_reference/#variables-in-devcontainerjson)
`devcontainer.json` ã§ä½¿ãˆã‚‹å¤‰æ•°ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚è©³ç´°ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## Customizations
ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå›ºæœ‰ã®è¨­å®šã‚’è¨˜è¼‰ã—ã¾ã™ã€ã“ã®è¨˜äº‹ã§ã¯ VSCode ã®åˆ©ç”¨ã‚’å‰æã¨ã—ã¦ã„ã‚‹ã®ã§ VSCode ã«é–¢ã—ã¦ã®è¨­å®šã‚’[ç´¹ä»‹](https://containers.dev/supporting#visual-studio-code)ã—ã¾ã™ã€‚

å¤§ã¾ã‹ã«ã¯ä»¥ä¸‹ã®æ§‹æˆã¨ãªã£ã¦ãŠã‚Šã€`settings` ã§ settings.json ã«æ›¸ã„ã¦ã‚ã‚‹å†…å®¹ã‚’æ›¸ãã“ã¨ã§ DevContainer å†…ã®é–‹ç™ºç’°å¢ƒã®ã‚¨ãƒ‡ã‚£ã‚¿è¨­å®šã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã¾ãŸã€`extensions` ã§æ‹¡å¼µã® ID ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ Dev Container å†…ã§åˆ©ç”¨ã§ãã‚‹æ‹¡å¼µã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```json
"customizations": {
        // Configure properties specific to VS Code.
        "vscode": {
            // Set *default* container specific settings.json values on container create.
            "settings": {},
            "extensions": [],
        }
}
```

ã“ã“ã§è¨­å®šã•ã‚ŒãŸã€è¨­å®šã¯ workspace è¨­å®šã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã®ä¸­é–“ã®å„ªå…ˆåº¦ã§ã‚ã‚Šãƒãƒ¼ãƒ é–“ã§ VSCode ã®è¨­å®šã‚’å…±æœ‰ã—ãŸã„å ´åˆã«éå¸¸ã«ä¾¿åˆ©ã§ã™ã€‚
(ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã‚’æ°—ã«å…¥ã‚‰ãªã„å ´åˆé©å®œ workspace è¨­å®šã§ä¸Šæ›¸ãã§ãã‚‹)

# `pyproject.toml`
ã‚¨ãƒ‡ã‚£ã‚¿è¨­å®šã«ã‚ˆã‚Šã€ruff ã‚„ mypy ã®è¨­å®šã¯ã“ã“ã«è¨˜è¼‰ã•ã‚ŒãŸã‚‚ã®ãŒåˆ©ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
ãã‚Œãã‚Œã®è¨­å®šæ–¹æ³•ã«é–¢ã—ã¦ã¯ä»¥ä¸‹ãŒè©³ã—ã„ã®ã§å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã€€
- [ruff](https://docs.astral.sh/ruff/settings/)
- [mypy](https://mypy.readthedocs.io/en/stable/config_file.html#the-mypy-configuration-file)

[^1]:`NO_CACHE_DIR` ã«å¯¾ã—ã¦ `off` ã®å€¤ã‚’è¨­å®šã™ã‚‹ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæœ‰åŠ¹ã«ãªã‚‹ã‚ˆã†ã«æ€ãˆã‚‹ã€‚ã“ã‚Œã¯ãƒã‚°ã«ã‚ˆã‚Šä»¥å‰ã¯ falsy ãªå€¤ã‚’è¨­å®šã—ãªã„ã¨è¨­å®šã‚’æœ‰åŠ¹ã«ã§ããªã‹ã£ãŸãŸã‚ã§ã‚ã‚‹ã€‚ç¾åœ¨ã¯å€¤ã‚’ä½•ã‹ã—ã‚‰è¨­å®šã™ã‚Œã°è¨­å®šã‚’æœ‰åŠ¹ã«ã§ãã‚‹ã®ã§ `on` ã¨è¨­å®šã™ã‚‹ã®ãŒè‡ªç„¶ã ãŒå¾Œæ–¹äº’æ›æ€§ã‚’è€ƒãˆã¦ `off` ã‚’æ¡ç”¨ã—ãŸã€‚ [code](https://github.com/pypa/pip/blob/a84b9650a1386e1eb6edef5db0aa7addf2fc2c0c/src/pip/_internal/cli/cmdoptions.py#L689-L715)
[^2]: ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã¨ã€`{cache-dir}/virtualenvs` ä»¥ä¸‹ã«ä»®æƒ³ç’°å¢ƒãŒä½œæˆã•ã‚Œ devcontainer ã®è¨­å®šã«å¯¾ã—ã¦ python ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒé›£ã—ã‹ã£ãŸã®ã§æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ã€‚
[^3]: æ­£ç¢ºã«ã¯ `.devcontainer/devcontainer.json`ã€`.devcontainer.json`ã€`.devcontainer/<folder>/devcontainer.json`ã€‚[doc](https://containers.dev/implementors/spec/#devcontainerjson)
